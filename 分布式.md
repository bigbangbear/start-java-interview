# 分布式理论

## CAP 

C：一致性，所有的节点同一时间数据相同，响应给客户端最新的数据

A：可用性，正常响应内可用

P：分区容错性，网络分区导致节点故障时仍旧能够提供一致性或者可用性

# 分布式一致性

## 一致性

* 最终一致性
* 强一致性

## 一致性算法

### 2PC 

角色：协调者、参与者

阶段一：

* 协调者向参与者发送事务，询问是否可以执行
* 参与者执行事务并且写入 undo log / redo log，返回执行情况给协调者

阶段二：

* 协调者根据参与者响应情况通知参与者提交或者回滚
* 参与者执行提交或者回滚

### **Raft**

角色：leader、flower

Leader 选举：

1. 如果集群中没有 Leader，flower 定时器会倒计时，到时后会竞选 Leader。
2. 如果获取到多数派，成为 Leader。负责接受客户端的读写请求
3. 接受客户端的提案，同步给从节点，如果收到多数确认后，通知客户端成功。并且通知从节点写入

### ZAB 

# 分布式事务

## TCC

- Try 指的是预留，即资源的预留和锁定，**注意是预留**。
- Confirm 指的是确认操作，这一步其实就是真正的执行了。
- Cancel 指的是撤销操作，可以理解为把预留阶段的动作撤销了